---
title: Overview
author: David Kane and Ansh Pathak
tutorial:
  id: 99-overview
output:
  learnr::tutorial:
    progressive: yes
    allow_skip: yes
runtime: shiny_prerendered
description: 'Overview tutorial for entire book'
---

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(tidycensus)
library(tidyverse)
library(knitr)


# income_tx <- get_acs(
#   geography = "county",
#   variables = "B19013_001",
#   state = "TX",
#   year = 2020,
#   geometry = TRUE
# )
# write_rds(income_tx, "data/income_tx.rds")

income_tx <- read_rds("data/income_tx.rds")


# edu_ca <- get_acs(
#   geography = "county",
#   variables = c("B15003_001", "B15003_022", "B15003_023", "B15003_024", "B15003_025"),
#   state = "CA",
#   year = 2020,
#   geometry = TRUE,
#   summary_var = "B15003_001"
# )
#  write_rds(edu_ca, "data/edu_ca.rds")

edu_ca <- read_rds("data/edu_ca.rds")


# age_ca <- get_acs(
#   geography = "county",
#   variables = c(median_age = "B01002_001", population = "B01003_001"),
#   state = "CA",
#   year = 2020,
#   geometry = FALSE
# )
# write_rds(age_ca, "data/age_ca.rds")

age_ca <- read_rds("data/age_ca.rds")




knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 600, 
        tutorial.storage = "local") 
```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```


## Introduction

<!-- DK: Overview introduction. Link to the book.  -->

The smallest unit at which data are made available from the decennial US Census is the block, and the smallest unit available in the ACS is the block group, which represents a collection of blocks. Other surveys are generally available at higher levels of aggregation.

<!-- DK: Do the repo -> project -> quarto stuff. -->


## Texas Income
###

<!-- DK? Tell me what I am going to learn. -->

### Exercise 1

Create a Github repo called `tidycensus-plots`. Make sure to click the "Add a README file" check box.

Connect the repo to a project on your computer using `File -> New Folder from Git ...`. Make sure to select the "Open in a new window" box. 

You need two Positon windows: this one for running the tutorial and the one you just created for writing your code and interacting with the Console.

Select `File -> New File -> Quarto Document ...`. Provide a title -- `"TexasIncome"` -- and an author (you). Render the document and save it as `TexasIncome.qmd`.

Create a `.gitignore` file with `_files` on the first line and then a blank line. Save and push.

In the Console, run:

```         
show_file(".gitignore")
```

If that fails, it is probably because you have not yet loaded `library(tutorial.helpers)` in the Console.

CP/CR.

```{r texas-income-1}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

### 

Professionals keep their data science work in the cloud because laptops fail.

### Exercise 2

In your QMD, put `library(tidyverse)` and  `library(tidycensus)` in a new code chunk. Press `Ctrl/Cmd + Shift + K` to render the file

Notice that the file does not look good because the code is visible and there are annoying messages. To take care of this, add `#| message: false` to remove all the messages in this `setup` chunk. Also add the following to the YAML header to remove all code echos from the HTML:

```         
execute: 
  echo: false
```

In the Console, run:

```         
tutorial.helpers::show_file("TexasIncome.qmd", chunk = "Last")
```

CP/CR.

```{r texas-income-2}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

Render again. Everything looks nice, albeit empty, because we have added code to make the file look better and more professional.

### Exercise 3

Place your cursor in the QMD file on the `library(tidyverse)` line. Use `Cmd/Ctrl + Enter` to execute that line.

Note that this causes `library(tidyverse)` to be copied down to the Console and then executed. 

CP/CR.

```{r texas-income-3}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

Always pair `get_acs()` with **tidyverse** functions for filtering, transforming, and visualizing your data.

### Exercise 4

Ask AI to use **tidycensus** to get data on the median household income for all counties in Texas for 2020.

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the Console.

CP/CR.

```{r texas-income-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

Our answer:

````

````

Tip: Always inspect your output using `glimpse()` or `head()` before plotting.

### Exercise 5

Now ask your AI to include `geometry = TRUE`

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r texas-income-5}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

 The `geometry = TRUE` argument returns spatial polygons, useful for maps and spatial analysis.

### Exercise 6

Here is our code. It is okay if your code is different. That will happen when using AI!
Replace your code with what it gave you using this code: 

````
income_tx <- get_acs(
  geography = "county",
  variables = "B19013_001",
  state = "TX",
  year = 2020,
  geometry = FALSE
)
````

###

`get_acs()` is part of the tidycensus package and allows downloading American Community Survey (ACS) data.

### Exercise 7

Now you will use AI to generate code that creates a plot of median household income in Texas counties.

Send our code to the console from the previous exercise.

Now, type `income_tx` in the console.

CP/CR the first few lines.

```{r texas-income-7}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

`ggplot2` is ideal for Census data due to its support for basic charts, group comparisons, and geospatial visualizations.


### Exercise 8

Now copy the first few lines into your AI and say that you are working with tidyverse. Tell it to take the data in `income_tx` and make a choropleth map of median household income.


Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r texas-income-8}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

You can create histograms, bar charts, and scatterplots of Census variables using `ggplot()`, often starting with `aes(x = estimate)` or `aes(x = var1, y = var2)`

### Exercise 9

Now, ask the AI to color counties by the estimate column and add an approprite title and theme. 


Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r texas-income-9}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```
###


When mapping spatial Census data, use `geom_sf()` in `ggplot2` and apply `fill = estimate` to show choropleth patterns.


### Exercise 10

Here is our code. It is okay if your code is different. That will happen when using AI!
Replace your code with what it gave you using this code: 

````
ggplot(income_tx) +
  geom_sf(aes(fill = estimate), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Median Income") +
  labs(
    title = "Median Household Income by County, Texas (2020)",
    caption = "Data source: ACS 5-year estimates"
  ) +
  theme_minimal()
````

###

`geom_sf()` plots spatial data stored as simple features (`sf` objects). The `fill` aesthetic maps color to median income. The `viridis` color scale provides perceptually uniform colors for better interpretation.
```{r}
#| message: false
ggplot(income_tx) +
  geom_sf(aes(fill = estimate), color = "white", size = 0.2) +
  scale_fill_viridis_c(option = "plasma", name = "Median Income") +
  labs(
    title = "Median Household Income by County, Texas (2020)",
    caption = "Data source: ACS 5-year estimates"
  ) +
  theme_minimal()
```

### Exercise 11


1. In the Console, run the following command to display the last chunk of your `.qmd` file: CP/CR

tutorial.helpers::show_file("TexasIncome.qmd", chunk = "last")

```{r texas-income-11}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 15)
```

###

The `show_file()` function from tutorial.helpers is a convenient way to check the contents of files without leaving R. It helps confirm that your edits were saved properly.


## California Bachelors Degree




### Exercise 1

Select `File -> New File -> Quarto Document ...`. Provide a title -- `"CaliforniaBachelors"` -- and an author (you). Render the document and save it as `CaliforniaBachelors.qmd`.

In this exercise, we’ll get the percentage of adults with a bachelor’s degree or higher in each California county.

###

Did you know?

Visualizing Maps with `geometry = TRUE`
Passing `geometry = TRUE` to `get_acs()` returns spatial geometry as an `sf` object, which works well with `ggplot2` for choropleth maps.

### Exercise 2

In your QMD, put `library(tidyverse)` and  `library(tidycensus)` in a new code chunk. Press Ctrl/Cmd + Shift + K to render the file

Notice that the file does not look good because the code is visible and there are annoying messages. To take care of this, add `#| message: false` to remove all the messages in this `setup` chunk. Also add the following to the YAML header to remove all code echos from the HTML:

```         
execute: 
  echo: false
```

In the Console, run:

```         
tutorial.helpers::show_file("CaliforniaBachelors.qmd", start = -5)
```

CP/CR.

```{r california-bachelors-degree-2}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

Render again. Everything looks nice, albeit empty, because we have added code to make the file look better and more professional.

### Exercise 3

Place your cursor in the QMD file on the `library(tidyverse)` line. Use `Cmd/Ctrl + Enter` to execute that line.

Note that this causes `library(tidyverse)` to be copied down to the Console and then executed. 

CP/CR.

```{r california-bachelors-degree-3}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

Working in the console like this is how professionals work!

### Exercise 4

- Ask an AI assistant (like ChatGPT) to generate R code that uses tidycensus to get educational attainment variables for all California counties in 2020 and save it in a variable called `edu_ca`

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR


```{r california-bachelors-degree-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```


###

Did you know? You can use `load_variables()` and filter/search the resulting data frame to explore variable descriptions and codes, such as "`B19013_001`" for median household income.

### Exercise 5

Now, tell your AI to add include `geometry = TRUE`

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR


```{r california-bachelors-degree-5}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

The American Community Survey (ACS) provides annual demographic, economic, and housing data based on samples, while the Decennial Census gives a complete count every 10 years.

### Exercise 6

Here is our code. It is okay if your code is different. That will happen when using AI!
Replace your code with what it gave you using this code: 
 
````
edu_ca <- get_acs(
  geography = "county",
  variables = c("B15003_001", "B15003_022", "B15003_023", "B15003_024", "B15003_025"),
  state = "CA",
  year = 2020,
  geometry = TRUE,
  summary_var = "B15003_001"
)
````

###

The `get_acs()` function is powerful for pulling American Community Survey (ACS) data. 

### Exercise 7

We’ll now make a choropleth map of bachelor’s degree attainment across California counties.

Send our code to the console from the previous exercise.

Now, type `edu_ca` in the console.

CP/CR the first few lines.

```{r california-bachelors-degree-7}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

Geometry must be `TRUE` if we want to map later.

### Exercise 8

Now copy the first few lines into your AI and say that you are working with tidyverse. Tell it to take the data in `edu_ca` and make a choropleth map of at least bachelor’s degree attainment or higher across California counties.

Tell it to also use `mutate()` to calculate the percentage of the population with at least a bachelor’s degree and pipe it into a `ggplot()`

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r california-bachelors-degree-8}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

For educational attainment, we use `B15003_022` through `B15003_025` to sum all individuals with a bachelor’s degree or more, then divide by the total population (variable `B15003_001`). 

### Exercise 9

Now, tell it to also use `geom_sf(aes(fill = percent))` and a `scale_fill_viridis_c()` to make it look nice

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r california-bachelors-degree-9}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

The `scale_fill_viridis_c()` function applies colorblind-friendly color scales to maps, using palettes like viridis, plasma, or magma.

### Exercise 10

Here is our code. It is okay if your code is different. That will happen when using AI!
Replace your code with what it gave you using this code: 

````
edu_ca <- edu_ca %>%
  group_by(GEOID) %>%
  summarize(
    percent = 100 * sum(estimate[variable != "B15003_001"]) / unique(summary_est)
  )

ggplot(edu_ca) +
  geom_sf(aes(fill = percent)) +
  scale_fill_viridis_c(option = "C") +
  labs(title = "Adult Percentage with at least a Bachelor's in CA (2020)",
       fill = "% with Degree") +
  theme_minimal()
````

```{r}
#| message: false
edu_ca <- edu_ca %>%
  group_by(GEOID) %>%
  summarize(
    percent = 100 * sum(estimate[variable != "B15003_001"]) / unique(summary_est)
  )

ggplot(edu_ca) +
  geom_sf(aes(fill = percent)) +
  scale_fill_viridis_c(option = "C") +
  labs(title = "Adult Percentage with at least a Bachelor's in CA (2020)",
       fill = "% with Degree") +
  theme_minimal()
```

###

`ggplot2` can handle spatial data directly using `geom_sf()`. Use `mutate()` to calculate percentages, and pipe that into `ggplot()` for a map.


### Exercise 11


1. In the Console, run the following command to display the last chunk of your `.qmd` file: CP/CR

tutorial.helpers::show_file("CaliforniaBachelors.qmd", chunk = "last")

```{r california-bachelors-degree-11}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 15)
```

###

The variables in `get_acs()` like `"B19013_001"` are codes that represent specific census survey questions or data points.

 You can use the `load_variables()` function from tidycensus to look up what each code means and explore available variables for a given year and dataset. 
 
 This helps you find exactly the data you need without guessing variable names.


## California Median Age

### Exercise 1

Select `File -> New File -> Quarto Document ...`. Provide a title -- `"CaliforniaAge"` -- and an author (you). Render the document and save it as `CaliforniaAge.qmd`.

In this exercise, you will collect median age data for all counties in California for the year 2020 using the `tidycensus` package.

###




### Exercise 2

In your QMD, put `library(tidyverse)` and  `library(tidycensus)` in a new code chunk. Press Ctrl/Cmd + Shift + K to render the file

Notice that the file does not look good because the code is visible and there are annoying messages. To take care of this, add `#| message: false` to remove all the messages in this `setup` chunk. Also add the following to the YAML header to remove all code echos from the HTML:

```         
execute: 
  echo: false
```

In the Console, run:

```         
tutorial.helpers::show_file("CaliforniaAge.qmd", start = -5)
```

CP/CR.

```{r california-median-age-2}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

### 

Render again. Everything looks nice, albeit empty, because we have added code to make the file look better and more professional.

### Exercise 3

Place your cursor in the QMD file on the `library(tidyverse)` line. Use `Cmd/Ctrl + Enter` to execute that line.

Note that this causes `library(tidyverse)` to be copied down to the Console and then executed. 

CP/CR.

```{r california-median-age-3}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

Working in the console like this is how professionals work!



### Exercise 4


Ask an AI assistant (such as ChatGPT) to generate R code that uses tidycensus data to get both the median age and populations for all counties in California for 2020 in a variable called `age_ca`


Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r california-median-age-4}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```


### 

AI is your best friend! Professionals use AI to generate code and plot. You however, need to be careful as it can and will generate much extra code that you may not need.

### Exercise 5

Now, tell your AI to set `geometry = FALSE` and only give the part to get the data into the variable.

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r california-median-age-5}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

Set geometry = TRUE in `get_acs()` or `get_decennial()` if you do not need spatial data.

### Exercise 6

Here is our code. It is okay if your code is different. That will happen when using AI!
Replace your code with what it gave you using this code: 

````
age_ca <- get_acs(
  geography = "county",
  variables = c(median_age = "B01002_001", population = "B01003_001"),
  state = "CA",
  year = 2020,
  geometry = FALSE
)
````


###

`get_acs()` is your go-to for detailed annual demographic estimates from the American Community Survey. It returns both point estimates and margins of error (MOE) by default.

### Exercise 7

Send our code to the console from the previous exercise.

Now, type `age_ca` in the console.

CP/CR the first few lines.

```{r california-median-age-7}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 3)
```

###

Helpful info for the next exercise: 
`geom_col()` from `ggplot2`: Creates bar charts where bar heights correspond to values in the data.

### Exercise 8

Now, copy/paste those few lines into your AI. Tell it to use the `age_ca` data and make a bar plot showing median age by county.



Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r california-median-age-8}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

Annotate charts with `geom_text()` or `labs()` to add clarity about what each axis, facet, or fill represents—especially useful for public-facing work.

### Exercise 9

Now we have a basic bar plot, but we have too much data points.

Tell your AI to filter the dataset to the 15 most populous counties and add informative labels and a title with `labs()`.

Put what it gives you in your code chunk and do `Ctrl/Cmd + Enter` to send it to the console

CP/CR

```{r california-median-age-9}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 6)
```

###

`theme_minimal()` from `ggplot2`:
Applies a clean, minimal theme to the plot for better readability.

### Exercise 10

Here is our code. It is okay if your code is different. That will happen when using AI!
Replace your code with what it gave you using this code: 

````
age_ca_wide <- age_ca %>%
  select(NAME, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate)

largest_ca <- age_ca_wide %>%
  arrange(desc(population)) %>%
  slice_head(n = 15)

ggplot(largest_ca, aes(x = reorder(NAME, median_age), y = median_age)) +
  geom_col(fill = "#4daf4a") +
  coord_flip() +
  labs(
    title = "2020 California Counties Median Age",
    x = "County",
    y = "Median Age",
    caption = "Source: ACS 5-Year Estimates via tidycensus"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.text.y = element_text(size = 10)
  )
````

```{r}
#| message: false
age_ca_wide <- age_ca %>%
  select(NAME, variable, estimate) %>%
  pivot_wider(names_from = variable, values_from = estimate)

largest_ca <- age_ca_wide %>%
  arrange(desc(population)) %>%
  slice_head(n = 15)

ggplot(largest_ca, aes(x = reorder(NAME, median_age), y = median_age)) +
  geom_col(fill = "#4daf4a") +
  coord_flip() +
  labs(
    title = "2020 California Counties Median Age",
    x = "County",
    y = "Median Age",
    caption = "Source: ACS 5-Year Estimates via tidycensus"
  ) +
  theme_minimal() +
  theme(
    plot.title = element_text(size = 16, face = "bold"),
    axis.text.y = element_text(size = 10)
  )
```

###

`coord_flip()` from ggplot2:
Flips x and y axes, often used to make horizontal bar charts easier to read.


### Exercise 11


1. In the Console, run the following command to display the last chunk of your `.qmd` file: CP/CR

tutorial.helpers::show_file("CaliforniaAge.qmd", chunk = "last")

```{r california-median-age-11}
question_text(NULL,
	answer(NULL, correct = TRUE),
	allow_retry = TRUE,
	try_again_button = "Edit Answer",
	incorrect = NULL,
	rows = 15)
```

###

The `show_file()` function from tutorial.helpers is a convenient way to check the contents of files without leaving R. It helps confirm that your edits were saved properly.


```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```


### Good Knowledge Drops

