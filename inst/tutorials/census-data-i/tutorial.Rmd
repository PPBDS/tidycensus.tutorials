---
title: Census Data I
author: Miriam Heiss, Soham Gunturu, and Anmay Gupta
tutorial:
  id: census-data-i
output:
  learnr::tutorial:
    progressive:  true
    allow_skip::  true
runtime: shiny_prerendered
description: Downloading US Census Bureau data into R
---

<!-- DK: Do we need all these libraries? And which ones need to appear in Suggests? -->

```{r setup, include = FALSE}
library(learnr)
library(tutorial.helpers)
library(tidyverse)
library(tidycensus)
library(sf)
library(ipumsr)
library(ggthemes)
library(tigris)
library(tmap)
library(knitr)
library(mapview)
library(leaflet)
library(glue)
library(patchwork)

# Time limit is longer than the default because plotting was taking longer than
# the usual limit of 60 seconds, at least for some students.

knitr::opts_chunk$set(echo = FALSE)
options(tutorial.exercise.timelimit = 240, 
        tutorial.storage = "local",
        tigris_use_cache = TRUE) 

# Center the tutorial around this book: https://walker-data.com/census-r/index.html

st <- states(year = 2019)

dc_income <- get_acs(
  geography = "tract",
   variables = "B19013_001",
   state = "DC",
   year = 2021,
   geometry = TRUE
 )

dc_income <- read_rds("data/dc_income.rds")

us_median_age <- read_rds("data/us_median_age.rds")

hennepin_race <- read_rds("data/hennepin_race.rds")

dallas_bachelors <- read_rds("data/dallas_bachelors.rds")

dekalb_years <- read_rds("data/dekalb_years.rds")

hennepin_black <- hennepin_race |>
  filter(variable == "Black")
 
pal <- colorNumeric(
  palette = "magma",
  domain = dallas_bachelors$estimate
)

fertility_data <- read_rds("data/fertility_data.rds")

fertility_data$tooltip <- paste0(fertility_data$name, ": ", 
                                 round(fertility_data$tfr, 2))

## Needed for chapter 4 - margin of error

years <- 2005:2019

```

```{r copy-code-chunk, child = system.file("child_documents/copy_button.Rmd", package = "tutorial.helpers")}
```

```{r info-section, child = system.file("child_documents/info_section.Rmd", package = "tutorial.helpers")}
```

<!-- DK: Just added in the sf package. Mention explicitly that this needs to be loaded. -->

## Introduction
###

Let's learn how to work with and map data from the US Census. We (mostly) follow the approach of [*Analyzing US Census Data: Methods, Maps, and Models in R*](https://walker-data.com/census-r/index.html) by Kyle Walker. If you would like to work more with census data, follow Walker's advice closely.

## Getting data 
### 

<!-- DK: Chapter 2? -->

The Census API works by accessing Census databases and tables. We can find these tables by visiting [data.census.gov](data.census.gov). We will learn how to access data from the **American Community Survey**, the **Decennial Census**, and the **Population Estimates Program** in this section. 

### Exercise 1

Let's try accessing the Decennial Census database. In order to do this, we'll use the `get_decennial()` function with the `geography`, `variables`, and `year` arguments.

### 

Let's try to find the total American population by state. First of all, we need to access the variable containing these populations, which is `P001001`.

### 

Run `get_decennial()` below setting `geography` to  `"state"`, `variables` to `"P001001"`, and `year` to `2010`.

```{r getting-data-1, exercise = TRUE}

```

```{r getting-data-1-hint-1, eval = FALSE}
get_decennial(... = "...", 
              variables = "..."
              ... = 2010)
```

### 

This should return a tibble with 52 rows and 4 columns, and should start like the image below.

```{r}
include_graphics("images/first_decennial.png")
```

### 

The `geography` argument determines the scope of the data (such as `us` for the entire country and `county` for counties), the `variables` argument defines which variables you want to use, and the `year` argument defines the year that our data comes from.

### Exercise 2

Copy and paste your code from above and change the `year` argument, and set it to `2020`. Change the `variables` argument to `"P1_001N"`, because the `"P001001"` was renamed starting in 2020.

```{r getting-data-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-2-hint-1, eval = FALSE}
get_decennial(... = "...", 
              variables = "...",
              year = ...)
```

### 

By changing the `year` argument, we can specify when we want our data to be from. 

### Exercise 3

Along with the arguments we have already learned, there is also the `sumfile` argument, or "summary file". 

### 

Run the `get_decennial()` function below setting `geography` to `"state"`, `variables` to `"P1_005N"`, `year` to `2020`, and `sumfile` to `"pl"`.

```{r getting-data-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-3-hint-1, eval = FALSE}
get_decennial(geography = "...",
        variables      = "...",
        year = ...,
        sumfile = "..."
)
```

### 

This retrieves information on the American Indian & Alaska Native population by state from the 2020 decennial Census. The `pl` summary file is one type that is a limited subset of variables from the decennial US Census to be used for legislative redistricting. 

To learn more about the `sumfile`, we again recommend Walker's [book](https://walker-data.com/census-r/an-introduction-to-tidycensus.html#getting-started-with-tidycensus).

### Exercise 4

Just as `get_decennial()` gets information from the Decennial Census, `get_acs()` gets information from the **A**merican **C**ommunity **S**urvey. 

### 

Run the `get_acs()` function setting `geography` to  `"state"`, `variables` to `"B05006_150"` and `year` to `2021`.

```{r getting-data-4, exercise = TRUE}

```

```{r getting-data-4-hint-1, eval = FALSE}
get_acs(geography = "...",
        variables      = "...",
        year = ...
)
```

### 

The example above fetches data on the number of residents born in Mexico by state. Notice that the tibble produced has an `estimate` and a `moe` column rather than a `value` column like the Decennial Census data. 

<!-- DK: Awkward. -->

**This is important.**

### Exercise 5

Along with the arguments, we've already learned, there is also a `survey` argument. This argument defaults to 5 year periods if not specified. We can change it to a one-year period rather than a default 5-year period by adding `survey = "acs1"`.

### 

Run `get_acs` below setting `geography` to `"state"`, `variables` to `"B05006_150"`, `survey` = `"acs1"`, and `year` to `2021`.


```{r getting-data-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-5-hint-1, eval = FALSE}
get_acs(... = "...", 
        variables = "...", 
        survey = "...",
        ... = 2019)
```

### 

The above function yields data on the number of residents born in Mexico by state in the year of just 2021 instead of a 5-year period as earlier. 

### 

Notice that the GEOID column contains the [FIPS code](https://transition.fcc.gov/oet/info/maps/census/fips/fips.txt#:~:text=FIPS%20codes%20are%20numbers%20which,to%20which%20the%20county%20belongs.) of the area the data covers. This code is a standardized way to identify different geographical areas. It gets larger as the area under consideration narrows. The FIPS for Massachusetts is 25. For Middlesex County within Massachusetts, the FIPS is 25017.


### Exercise 6

Rather than using the `variables` argument, you can supply a table name to the `table` parameter in `get_acs()`; this will return data for every variable in that table. 

Run `get_acs()` below setting `geography` to `"state"`, `table` to `"B01001"`, and `year` to `2021`

```{r getting-data-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-6-hint-1, eval = FALSE}
get_acs(... = "...", 
        table = "...",
        ... = ...)
```

### 

This code got all variables associated with table `B01001`, which covers sex broken down by age, from the 2017-2021 5-year ACS.

### Exercise 7

What if we want to analyze a variable at the county level, but only in one state? We can use the `state` argument along with the geography argument.

### 

Run `get_acs()` below setting `geography` = `"county"`, `variables` to `"B19013_001"`, `state` to `"GA"`, and `year` to `2021`

```{r getting-data-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-7-hint-1, eval = FALSE}
get_acs(... = "...", 
        variables = "...", 
        ... = "WI",
        year = ...)
```

### 

The example above returns average household income by county, but only in the state of Georgia. When using the `state` argument, you can use the state name (`"Georgia"`), the state postal code (`"GA"`), or the FIPS code (`"13"`).

### Exercise 8

Smaller geographies, such as Census tracts, can be subsetted as well by the `county` argument. 

Run `get_acs()` below setting `geography` = `"tract"`, `variables` to `"B19013_001"`, `state` to `"13"`, `county` to `"Gwinnett"`, and `year` to `2021`

```{r getting-data-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-8-hint-1, eval = FALSE}
get_acs(geography = "...", 
        variables = "...", 
        state = "...", 
        ... = "Dane",
        ... = ...)
```

### 

The above code retrieves the average household income for every tract in Gwinnett County in Georgia. Subsetting is extremely useful, as it allows you to download only the data which is relevant to you.

### 

### Exercise 9

Let's switch gears. What if we don't know what a variable ID means; after all, they're just a bunch of letters and numbers.

Luckily, the **tidycensus** packages offers the `load_variables()` function. 

Run `load_variables()` setting `year` to `2021`, and `dataset` to `"acs5"`

```{r getting-data-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-9-hint-1, eval = FALSE}
load_variables(year = ..., dataset = "...")
```

### 

Notice the "label" and "concept" columns, providing information about each variable. To learn more about `load_variables()` and its arguments, go to [Kyle Walkers introduction to tidycensus](https://walker-data.com/census-r/an-introduction-to-tidycensus.html#searching-for-variables-in-tidycensus)

### Exercise 10

Now we may know what a variable name means, but it's probably pretty annoying to type that every, single time you need it. So how can we rename it?

Run `get_acs()` below setting `geography` to `"county"`, `state` = `"Utah"`, `variables` to a vector containing `medinc` which is assigned to `"B19013_001"` and `medage` which is assigned to `"B01002_001"`, and `year` to `2021`.  

```{r getting-data-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-10-hint-1, eval = FALSE}
get_acs(geography = "...",
        state = "...",
        ... = c(medinc = "...",
                      medage = "..."),
        year = ...)
```

### 

In the variable column, the values are "medinc" and "medage", not the complex ones we imported. 

### Exercise 11

Now, let's learn about `get_estimates()`.
This gets data from the **Population Estimates Program** (PEP). 

Run `get_estimates` below setting `geography` to `"county"`, `product` to `"components"`, `state` to `"GA"`, `county` to `"Chatham"`, and `year` to `2019`

```{r getting-data-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r getting-data-11-hint-1, eval = FALSE}
get_estimates(geography = "...",
              product = "...",
              ... = "...",
              county = "...",
              ... = ...)
```

### 

The code above requested all components of change population estimates for 2019 for Chatham County in Georgia. 

The confusing part of this function is probably the `product` argument, which essentially allows the user to access the indicators used to produce the intercensal population estimates. 

Learn more about `get_estimates()` and its arguments [here](https://walker-data.com/census-r/an-introduction-to-tidycensus.html#other-census-bureau-datasets-in-tidycensus)

### Exercise 12

`get_flows()` allows for analysis of immigrants, emigrants, and net migration for a given geography using data from a given 5-year ACS sample.

Run `get_flows()` below setting `geography` to `"county"`, `state` to `"HI"`, `county` to `"Honolulu"`, and `year` to `2019`

```{r getting-data-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>


```{r getting-data-12-hint-1, eval = FALSE}
get_flows(geography = "...",
          ... = "...",
          county = "...",
          ... = ...)
```

### 

This should return a tibble with 6 columns, one of them being "variable". We can see variables such as "MOVEDIN" and the corresponding estimate of 152 as the number of people who moved from Africa (look at the `FULL2_NAME` variable) to Honolulu in 2019

### 

Congrats! You now have the necessary skills to pull all kinds of data from the [US Census Bureau](https://www.census.gov/).


## Margin of error
###

In this section, we are going to learn what a margin of error (moe) is, and how we can analyze and visualize it.

### Exercise 1

Run `get_acs()` below setting `geography` to `"county"`, `state` to `"Rhode Island"`, `variables` to `"B19013_001"` (median household income), and `year` to `2020`.

```{r margin-of-error-1, exercise = TRUE}

```

```{r margin-of-error-1-hint-1, eval = FALSE}
get_acs(geography = "...",
        state = "...",
        variables = "B19013_001",
        year = ...)
```

### 

There are only five counties in Rhode Island. In an ideal world, we would have the household income for every family in each county. If we did, we could precisely calculate what the median (and the mean and the max and . . .) household income is in each county. But we don't have data on every household because the ACS is a survey, unlike the Census. We only have a sample of some households in each county.

### 

We are not going to teach you statistics in this tutorial! Behind the scenes, the ACS is making all sorts of calculations. In the end, using statistics, they provide us with two numbers: an *estimate* of the median household income in each county and a *moe* (margin of error) for that estimate.

### 

In other words, the ACS calculated that a good estimate of the median household income in Bristol County is \$85,413. Is that the *true* number? The ACS does not know! It does not have data for all the households in Bristol County. The ACS only has data for a *sample* of households.
 

### Exercise 2

The estimate plus or minus the margin of error is known as a **confidence interval**. Let's explore that.

### 

Copy/paste your code from above. Add the `moe_level` argument and set it to `95`.

```{r margin-of-error-2, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-2-hint-1, eval = FALSE}
get_acs(geography = "...",
        state = "...",
        variables = "...",
        year = ...,
        moe_level = 95)
```

### 

The estimate remains constant, but the margin of error changes... why?

### 

Every confidence interval comes with a **confidence level**. This level defaults to 90%, but we changed it to 95% just now.

### Exercise 3

Copy/paste your code from above and change the `moe_level` from `95` to `99`.

```{r margin-of-error-3, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-3-hint-1, eval = FALSE}
get_acs(geography = "...",
        state = "...",
        variables = "...",
        year = ...,
        moe_level = 99)
```

### 

The `moe` column changed again.

### 

When the confidence level is 99%, it means (roughly!) that 99 out of 100 times, the true (and unknown) value of median household income will fall between the confidence interval's upper bound and lower bound. 

In the examples earlier, as confidence level increased, so did margin of error because if your interval is larger, there is a higher chance that the true value falls within it.

### Exercise 4

Copy/paste the code from Exercise 3 and run it without any changes.

```{r margin-of-error-4, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

### 

Let's look at the first column. The estimate is 85,413,	and the margin of error is 9,527. So the bottom bound of this interval is 85,413 - 9,527 = 75,886 and the upper bound is 85,413 + 9,527 = 94,940. 

The final interval is (75,885.75, 94,940.25) which is saying that the mean household income for Bristol County is between \$75,885.75 and \$94,940.25.

### 

You can learn more about a margin of error and some related functions [here](https://walker-data.com/census-r/wrangling-census-data-with-tidyverse-tools.html#handling-margins-of-error-in-the-american-community-survey-with-tidycensus).

### Exercise 5

So now that we have an idea of what a confidence interval and a margin of error are, let's visualize them.

We are going to create this graph:

```{r}
moe_hhincome_plot <- get_acs(state = "Maine", geography = "county", variables = c((hhincome = "B19013_001"), year = 2021)) |>
  mutate(NAME = str_remove(NAME, " County, Maine"))|>
  ggplot(mapping = aes(x = estimate, y = reorder(NAME, estimate))) +
  geom_pointrange(aes(xmax = estimate + moe, xmin = estimate - moe))+ 
  scale_x_continuous(labels = scales::label_dollar())+
  labs(title = "Median Household income in Maine Counties", 
       subtitle = "Counties Surrounding Portland seem to be Richer",
       y = "Counties",
       x = "Median Household income",
       caption = "2021 American Community Survey")

moe_hhincome_plot
```

### 

Run `get_acs()` below setting `state` to `"Maine"`, `geography` to `"county"`, `variables` to `c(hhincome = "B19013_001")` (remember we can rename variable names by doing it in a vector), and `year` to `2021`.

```{r margin-of-error-5, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-5-hint-1, eval = FALSE}
get_acs(state = "...",
        geography = "...",
        variables = c(hhincome = "..."),
        year = ...)
```

### 

This gives you your data, but the `NAME` column is somewhat annoying because it includes "County" and "Maine". We already know that they are counties in Maine so let's clean it up.

### Exercise 6

Copy/paste your code from last exercise. Pipe it into `mutate()`. Inside `mutate()`, set the `NAME` column to `str_remove(NAME, " County, Maine")`.

```{r margin-of-error-6, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-6-hint-1, eval = FALSE}
get_acs(state = "...",
        geography = "...",
        variables = c(hhincome = "..."),
        year = ...) |> 
  mutate(NAME = str_remove(NAME, " County, Maine"))
```

### 

The `str_remove()` function looked at the `NAME` column (1st argument) and removed the text that was specified in the second argument. 

### Exercise 7

Copy/paste your code from above and pipe it into `ggplot()`. Set `x` to `estimate` and `y` to `reorder(NAME, estimate)`.

```{r margin-of-error-7, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-7-hint-1, eval = FALSE}
... |> 
  ggplot(aes(x = ..., 
             y = reorder(NAME, estimate)))
```

### 

By reordering the names on the y-axis based on their `estimate` value, we avoid the sloppiness of the default ordering, which would have been alphabetical.

### Exercise 8

We will be using `geom_pointrange`, which is very similar to `geom_point()` but with a line going through it to show the range and margin of error.

### 

For `geom_pointrange` to show the margin of error, we will need to do some (very basic) math. We need to make the high end and the low end of the margin of error, by adding and subtracting `moe` from `estimate`, like this: `geom_pointrange(aes(xmax = estimate + moe, xmin = estimate - moe))`.

```{r margin-of-error-8, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-8-hint-1, eval = FALSE}
... +
  geom_pointrange(aes(xmax = ..., xmin = ...))
```

### 

Now, we need to fix our x-axis.

### Exercise 9

We need to add dollar signs to signify that this represents money.

### 

Add the `scale_x_continuous()` layer setting `labels` to `scales::label_dollar()`.

```{r margin-of-error-9, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-9-hint-1, eval = FALSE}
... +
  scale_x_continuous(labels = scales::label_dollar())
```

### 

You can do a lot of things using the scales package, such as adding percent signs and dollar signs. You can learn more about scales [here](https://scales.r-lib.org/).

### Exercise 10

Add the appropriate labels. Remember, our graph should look like this:

```{r}
moe_hhincome_plot
```

```{r margin-of-error-10, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-10-hint-1, eval = FALSE}
... + 
  labs(...)
```

### 

We just visualized margins of error at one moment in time, now, we are going to make a plot that spans multiple years. You can learn more about visualizing margins of error [here](https://walker-data.com/census-r/exploring-us-census-data-with-visualization.html?q=margins%20of%20error#visualizing-margins-of-error)

### Exercise 11

We are going to create this plot:

```{r echo = FALSE}
years <- 2005:2019
names(years) <- years

dekalb_plot <- ggplot(dekalb_years, mapping = aes(x = Year, 
                                   y = estimate, 
                                   group = 1)) + 
  geom_line()+
  geom_point()+
  geom_ribbon(fill = "navy", alpha = 0.3, aes(ymax = estimate + moe, ymin = estimate - moe))+
  scale_y_continuous(labels = scales::label_dollar(scale = .001, suffix = "k"))
  
dekalb_plot
```

Create a vector named `years` that goes from `2005` through `2019`

```{r margin-of-error-11, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-11-hint-1, eval = FALSE}
years <- 2005:2019
```

### 

These are the years we will iterate over.

### Exercise 12

Run `library(purrr)` below

```{r margin-of-error-12, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-12-hint-1, eval = FALSE}
library(...)
```

### 

We will be using `map_dfr()` from the `purrr` package for this graph.

### 

For exercises 15-24, add the following line at the top of every code box:

`names(years) <- years`

Otherwise your graph will be a little (or a lot) wacky.

### Exercise 13

Run `map_dfr` below, setting the first argument to `years`. You WILL get an error.

```{r margin-of-error-13, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-13-hint-1, eval = FALSE}
names(years) <- years
map_dfr(years)
```

### 

The first argument just tells `map_dfr()` which object to iterate over.

### Exercise 14

Copy/paste your code from above. Your second argument should be enclosed within `~{}` (Curly brackets with a tilde in front.)

Inside the curly brackets, run `get_acs()` setting `geography` to `"county"`, `variables`   to `"B25077_001"`, `state` to `"GA"`, `county` to `"Dekalb"`, `year` to `.x`, and `survey` to `"acs1"`.

```{r margin-of-error-14, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-14-hint-1, eval = FALSE}
...
map_dfr(years,  ~{
  get_acs(
    geography = "...",
    variables = "...",
    state = "...",
    county = "...",
    year = .x,
    survey = "...")})

```

### 

By setting `year` to `.x`, the function iterates through our vector and grabs data from each year instead of just one. 

Our data should be there, but it's confusing to know which year is which. 

### Exercise 15

Copy/paste your code from above. Add a third argument in `map_dfr()`. The argument is `.id`, and you should set it to `"Year"`.

```{r margin-of-error-15, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-15-hint-1, eval = FALSE}
...
map_dfr(years,  ~{
  get_acs(geography = "...",
    variables = "...",
    state = "...",
    county = "...",
    year = .x,
    survey = "...")},
  .id = "Year")
```

### 

If you look at the data now, there should be a new `Year` column. This is what the `.id` argument does: it creates a new column in the output data frame that contains values equivalent to the names of the input object, which in this case is `years`.

### 

Now that we have our data, let's plot it.

### Exercise 16

Copy/paste your code from above. Pipe it into `ggplot()` setting `x` to `years`, `y` to `estimate`, and `group` to `1`.

```{r margin-of-error-16, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-16-hint-1, eval = FALSE}
... +
  ggplot(aes(x = years, y = estimate, group = 1))
```

### 

The argument group = 1 is used to help `ggplot()` understand how to connect the yearly data points with lines given that only one county is being visualized.

### Exercise 17

Add the `geom_line()` and `geom_point()` layers.

```{r margin-of-error-17, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-17-hint-1, eval = FALSE}
... + 
  geom_line() +
  geom_point()
```

### 

`geom_line()` draws the lines, and we layer points on top of the lines as well to highlight the actual ACS estimates.

### Exercise 18

We will add the margin of error component with `geom_ribbon()`.

### 

Add the `geom_ribbon` layer. Inside `aes()` set `ymin` to `estimate - moe` and `ymax` to `estimate + moe`.

```{r margin-of-error-18, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-18-hint-1, eval = FALSE}
... + 
  geom_ribbon(aes(ymin = estimate - moe,
                  ymax = estimate + moe))
```

### 

Now we need to add some styling arguments within `geom_ribbon()` outside of `aes()`

### Exercise 19

Outside of `aes()` but inside `geom_ribbon()`, set `fill` to `"navy"` and `alpha` to `0.3`.

```{r margin-of-error-19, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-19-hint-1, eval = FALSE}
... + 
  geom_ribbon(aes(...), fill = "...", alpha = ...)
```

### 

<!-- knowledge drop of sorts -->

### 

Now we need to re-label the y axis.

### Exercise 20

It's more appealing to see $400k for money rather than 400000. Let's do that.

### 

Add the `scale_y_continuous()` layer setting `labels` to `scales::label_dollar()`. Inside `label_dollar()`, set `scale` to `.001` and `suffix` to `"k"`.

```{r margin-of-error-20, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-20-hint-1, eval = FALSE}
... + 
  scale_y_continuous(labels = scales::label_dollar(scale = .001, suffix = "k"))
```

### 

We label the y-axis with dollar signs, divide them by 1000, and then add the "k" suffix.

### Exercise 21

Add the appropriate labels.

Remember our plot should look like this:

```{r}
include_graphics("images/moe_plt_time.png")
```

```{r margin-of-error-21, exercise = TRUE}

```

<button onclick = "transfer_code(this)">Copy previous code</button>

```{r margin-of-error-21-hint-1, eval = FALSE}
... + 
  labs(...)
```

### 

Now, we know what a margin of error is and how to plot it. We can also plot margins of error over many years and in one instance in time.



## Summary

From this tutorial, you should have gained a basic sense of the Census API, and how to use data from the US Census to create graphs and maps. 

Check out [this](https://walker-data.com/census-r/index.html) book to see more in-depth Census information. 

```{r download-answers, child = system.file("child_documents/download_answers.Rmd", package = "tutorial.helpers")}
```
